build_settings:
    mysql:
        host: 'localhost'
        user: 'root'
        pass: '!goosta!'

setup:
    mysql:
        - "DROP DATABASE IF EXISTS irispass_testing;"
        - "CREATE DATABASE irispass_testing;"
    shell:
        - "cd %BUILD_PATH% && cp .env.phpci .env"
        - "cd %BUILD_PATH% && curl -sS https://getcomposer.org/installer | php"
        - "cd %BUILD_PATH% && php composer.phar install --prefer-dist --no-interaction --dev"
        - "cd %BUILD_PATH% && php artisan migrate --seed --database=mysql_testing --env=phpci --no-interaction -vvv"

test:
    codeception:
        config: "."
        path: "tests/_log"

complete:
    mysql:
        - "DROP DATABASE irispass_testing;"
    slack_notify:
        webhook_url: "https://hooks.slack.com/services/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"
        room: "#irispass"
        username: "PHPCI"
        icon: ":ghost:"
        message: "%PROJECT_TITLE% - build %BUILD% completed"
        show_status: true

success:
    slack_notify:
        webhook_url: "https://hooks.slack.com/services/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"
        room: "#irispass"
        username: "PHPCI"
        icon: ":ghost:"
        message: "%PROJECT_TITLE% - build %BUILD% succeeded! :smiley:"
        show_status: false

failure:
    slack_notify:
        webhook_url: "https://hooks.slack.com/services/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"
        room: "#irispass"
        username: "PHPCI"
        icon: ":ghost:"
        message: "%PROJECT_TITLE% - build %BUILD% failed! :angry:"
        show_status: false